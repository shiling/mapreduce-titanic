<html>
    <head>
      <title>Titantic Map Reduce - Tutorial</title>
	    <!--BootStrap-->
	    <script src="http://code.jquery.com/jquery.js"></script>
	    <script src="js/bootstrap.min.js"></script>
	    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
	    <!--Site-->
	    <style type="text/css">
	        body {
	            margin:50px 0px; padding:0px;
	            text-align:center;
	            background-color:lightgrey;
	        }
	        #Content {
	            width:1000px;
	            margin:0px auto;
	            text-align:left;
	            padding:15px;
	            border:1px dashed #333;
	            background-color:white;
	        }
	        h1,h2{
	            text-align:center;
	        }
	        .code{
	            font-family:"Courier New";
	        }
	    </style>
    </head>
    <body>
    <div id="Content">

        <h1>Titanic Map Reduce</h1>

        <h3>Overview</h3>
        <br/>

        <h3>Demo (hosted on Google App Engine)</h3>
        <a href="http://mapreduce-stackoverflow.appspot.com/">Mirror 1</a>,
        <a href="http://mapreduce-titanic.appspot.com/">Mirror 2</a>,
        <a href="http://titanic-mapreduce.appspot.com/">Mirror 3</a><br/>
        <br/>

		<a name="datasets"></a>
        <h3>Datasets and Map Reduce Results</h3>
        <p> These datasets are obtained from <a href="www.kaggle.com">Kaggle.com</a> - <a href="www.kaggle.com/c/titanic-gettingStarted">Titanic: Machine Learning from Disaster Getting Started Competition</a>. <br/>
The small data set is the original data set, while the medium and large date sets are created by multiplying the small data set.</p>
        <table border="1">
            <tr><th>Name</th><th># Rows</th><th>Size</th><th>Dataset <br/>(hosted on Dropbox)</th><th>Dataset <br/>(hosted on Google Drive)</th><th>Map Reduce Results</th></tr>
            <tr>
                <td>Small - titanic.csv</td>
                <td>891</td>
                <td>61KB</td>
                <td><a href="data/titanic.csv">Download</a></td>
                <td><a href="https://docs.google.com/file/d/0B_xkO7M00_DSWVdxaEhxZExXSWs/edit">Download</a></td>
                <td><a href="http://mapreduce-stackoverflow.appspot.com/results.jsp?pipelineId=098198aa-c0b1-411b-b717-191c309aea76">View</a></td>            
            </tr>
            <tr>
                <td>Medium - titanic_medium.csv</td>
                <td>0.55 mil</td>
                <td>35MB</td>
                <td><a href="data/titanic_medium.csv">Download</a></td>
                <td><a href="https://docs.google.com/file/d/0B_xkO7M00_DSS1dIQWt3U3hTVEE/edit">Download</a></td>
<td><a href="http://mapreduce-stackoverflow.appspot.com/results.jsp?pipelineId=ba6517d9-f893-4d56-82df-0874d02fedde">View</a></td>
            </tr>
            <tr>
                <td>Large - titanic_large.csv</td>
                <td>1.1 mil</td>
                <td>70.1MB</td>
                <td><a href="data/titanic_large.csv">Download</a></td>
                <td><a href="https://docs.google.com/file/d/0B_xkO7M00_DSanM2RjRCOHlLdVU/edit">Download</a></td>
                <td><a href="http://mapreduce-stackoverflow.appspot.com/results.jsp?pipelineId=a068f8ab-3dc5-4a10-acdc-09b82b56c611">View (Failed - Insufficient Memory)</a></td>
            </tr>
        </table>
        <br/>

        <h2>10 Easy Steps Tutorial</h2>

        <h3>1. Install Eclipse with Google App Engine Plugin</h3>
        <div>
            Follow <a href="https://developers.google.com/appengine/docs/java/tools/eclipse">these instructions to install Eclispe and the Google App Engine Plugin</a>
        </div>

        <h3>2. Create a Google App Engine Web Application Project</h3>
        Run Eclipse and select from the menu bar "File > New > Web Application Project". <br/>
        Enter a name for the project and the package for your source codes, and uncheck the "Use Google Web Toolkit" option as shown below: <br/>
        <img src="img/create_project.png"/>

        <h3>3. Configuring the Google App Engine Web Application for Map Reduce</h3>
        <p>
        You will need some additional libraries to be able to use the Google App Engine Map Reduce API.<br/>
        Download the .jar files from <a href="googlemapreduce_lib.zip">here</a> and add them to your war/WEB-INF/lib/ directory.<br/>
        Select and right-click these .jar files in Eclipse's Project Explorer and select "Build Path > Add to Build Path".<br/>
        <br/>
        You will also need to add these servlet mappings to your war/web.xml file:<br/>
        <blockquote class="code">
        <!--code-->
            <br>&lt;servlet&gt;
            <br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;servlet-name&gt;mapreduce&lt;/servlet-name&gt;
            <br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;servlet-class&gt;
           	<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com.google.appengine.tools.mapreduce.MapReduceServlet
            <br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/servlet-class&gt;
            <br>&lt;/servlet&gt;
            <br>&lt;servlet-mapping&gt;
            <br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;servlet-name&gt;mapreduce&lt;/servlet-name&gt;
            <br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;url-pattern&gt;/mapreduce/*&lt;/url-pattern&gt;
            <br>&lt;/servlet-mapping&gt;
            <br>    
            <br>&lt;servlet&gt;
            <br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;servlet-name&gt;pipeline&lt;/servlet-name&gt;
            <br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;servlet-class&gt;
            <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com.google.appengine.tools.pipeline.impl.servlets.PipelineServlet
            <br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/servlet-class&gt;
            <br>&lt;/servlet&gt;
            <br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;servlet-mapping&gt;
            <br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;servlet-name&gt;pipeline&lt;/servlet-name&gt;
            <br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;url-pattern&gt;/_ah/pipeline/*&lt;/url-pattern&gt;
            <br>&lt;/servlet-mapping&gt;
        </blockquote>
		Now, you are ready to write a Google App Engine Map Reduce Web Application!
        </p>

        <h3>4. Uploading a data file to blobstore</h3>
		<p>
        First, you need a means to upload the datasets to your application.<br/>
		Create a new file war/index.jsp. <br/>
		Add the following code segments to index.jsp to create a form to upload a file to the Google App Engine Blobstore.<br/>
		<br/>
		<!-- code: index.jsp - upload file -->
		Import the BlobstoreService classes:
        <blockquote class="code">
			<br>&lt;%@&nbsp;page&nbsp;import=&quot;com.google.appengine.api.blobstore.BlobstoreServiceFactory&quot;&nbsp;%&gt;&nbsp;&nbsp;
			<br>&lt;%@&nbsp;page&nbsp;import=&quot;com.google.appengine.api.blobstore.BlobstoreService&quot;&nbsp;%&gt;&nbsp;&nbsp;
		</blockquote>
		Connect to Blobstore:
		<blockquote class="code">
			<br>&lt;%&nbsp;&nbsp;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;BlobstoreService&nbsp;blobstoreService&nbsp;=&nbsp;BlobstoreServiceFactory.getBlobstoreService();&nbsp;&nbsp;
			<br>%&gt;&nbsp;&nbsp;
		</blockquote>
		Create form to upload a file to the Blobstore and return to index.jsp:
		<blockquote class="code">
			<br>&lt;form&nbsp;action=&quot;&lt;%=&nbsp;blobstoreService.createUploadUrl(&quot;/index.jsp&quot;)&nbsp;%&gt;&quot;&nbsp;method=&quot;post&quot;&nbsp;enctype=&quot;multipart/form-data&quot;&gt;&nbsp;&nbsp;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;Analyse&nbsp;new&nbsp;data:&nbsp;&nbsp;&nbsp;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type=&quot;file&quot;/&gt;&nbsp;&nbsp;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type=&quot;submit&quot;&nbsp;value=&quot;Submit&quot;/&gt;&nbsp;&nbsp;
			<br>&lt;/form&gt;
		</blockquote>
		</p>

        <h3>5. Display the data files and create map reduce action buttons</h3>
		<p>
		Now, you need to display the uploaded files and provide buttons for triggering the map reducer. <br/>
		Add the following code segments to index.jsp: <br/>
		<br/>
		Import the BlobInfo (for accessing blob metadata) and Iterator classes:
        <blockquote class="code">
			<br>&lt;%@&nbsp;page&nbsp;import=&quot;java.util.Iterator&quot;&nbsp;%&gt;
			<br>&lt;%@&nbsp;page&nbsp;import=&quot;com.google.appengine.api.blobstore.BlobInfoFactory&quot;&nbsp;%&gt;
			<br>&lt;%@&nbsp;page&nbsp;import=&quot;com.google.appengine.api.blobstore.BlobInfo&quot;&nbsp;%&gt;
		</blockquote>
			Display the uploaded files and create buttons to trigger the map reducer.
		<blockquote class="code">
			<br>&lt;table&nbsp;border=&quot;1&quot;&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;&lt;th&gt;Time&nbsp;Uploaded&lt;/th&gt;&lt;th&gt;Filename&lt;/th&gt;&lt;th&gt;Size&nbsp;(KB)&lt;/th&gt;&lt;th&gt;Actions&lt;/th&gt;&lt;/tr&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;%
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Iterator&lt;BlobInfo&gt;&nbsp;blobInfos&nbsp;=&nbsp;new&nbsp;BlobInfoFactory().queryBlobInfos();
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while(blobInfos.hasNext()){
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlobInfo&nbsp;blobInfo&nbsp;=&nbsp;blobInfos.next();
			<br>&nbsp;&nbsp;&nbsp;&nbsp;%&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;%=blobInfo.getCreation()&nbsp;%&gt;&lt;/td&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;%=blobInfo.getFilename()&nbsp;%&gt;&lt;/td&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;%=blobInfo.getSize()/1024%&gt;&lt;/td&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;form&nbsp;action=&quot;/process&quot;&nbsp;method=&quot;post&quot;&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type=&quot;hidden&quot;&nbsp;name=&quot;blobKey&quot;&nbsp;value=&quot;&lt;%=blobInfo.getBlobKey().getKeyString()%&gt;&quot;/&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Analyse&nbsp;Death&nbsp;Count&nbsp;By:&nbsp;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type=&quot;submit&quot;&nbsp;name=&quot;category&quot;&nbsp;value=&quot;Passenger&nbsp;Class&quot;/&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type=&quot;submit&quot;&nbsp;name=&quot;category&quot;&nbsp;value=&quot;Gender&quot;/&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/form&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;%
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
			<br>&nbsp;&nbsp;&nbsp;&nbsp;%&gt;
			<br>&lt;/table&gt;
		</blockquote>
		This form will submit a POST request to the /process servlet which triggers the map reduce process.<br/>
		The blobKey of the dataset needs to be sent in order for the /process servlet to retrieve the dataset for processing.<br/>
		Category is also included to allow choice of category to analyse the dataset.
		</p>

        <h3>6. Create a servlet to trigger the Map Reduce on the dataset</h3>
		<p>
		
		Create a servlet and map it to the url "/process" in the web.xml. <br/>
		<br/>

		Import the mapreduce package:
		<blockquote class="code">
			<br>import&nbsp;com.google.appengine.tools.mapreduce.*;
		</blockquote>

		Write the servlet's post method, it will run the map reduce job and redirect to show the results:
		<blockquote class="code">
			<br>public&nbsp;void&nbsp;doPost(HttpServletRequest&nbsp;req,&nbsp;HttpServletResponse&nbsp;res)
			<br>&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;ServletException,&nbsp;IOException&nbsp;{
			<br>
			<br>&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;blobkey
			<br>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;blobKey&nbsp;=&nbsp;req.getParameter(&quot;blobKey&quot;);
			<br>
			<br>&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;category
			<br>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;category&nbsp;=&nbsp;req.getParameter(&quot;category&quot;);
			<br>&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;categoryIndex&nbsp;=&nbsp;category.equals(&quot;Passenger&nbsp;Class&quot;)&nbsp;?&nbsp;1&nbsp;:&nbsp;category.equals(&quot;Gender&quot;)?&nbsp;3&nbsp;:&nbsp;1;
			<br>
			<br>&nbsp;&nbsp;&nbsp;&nbsp;//run&nbsp;mapreduce
			<br>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;pipelineId&nbsp;=&nbsp;mapreduce(10,5);
			<br>
			<br>&nbsp;&nbsp;&nbsp;&nbsp;//response&nbsp;-&nbsp;show&nbsp;mapreduce&nbsp;results
			<br>&nbsp;&nbsp;&nbsp;&nbsp;res.sendRedirect(&quot;/results.jsp?pipelineId=&quot;+pipelineId);
			<br>}
		</blockquote>

		Add these methods for starting the map reduce job:
		<blockquote class="code">
			<br>//Run&nbsp;Map&nbsp;Reduce,&nbsp;returns&nbsp;the&nbsp;Job&nbsp;ID
			<br>private&nbsp;String&nbsp;mapreduce(int&nbsp;mapShardCount,&nbsp;int&nbsp;reduceShardCount,&nbsp;String&nbsp;blobKey,&nbsp;int&nbsp;categoryIndex)&nbsp;{
			<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;MapReduceJob.start(
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MapReduceSpecification.of(
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;titanic&nbsp;map&nbsp;reduce&quot;,
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;BlobstoreInput(blobKey,(byte)'\n',mapShardCount),
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;CountMapper(categoryIndex),
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Marshallers.getStringMarshaller(),
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Marshallers.getLongMarshaller(),
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;CountReducer(),
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;InMemoryOutput&lt;KeyValue&lt;String,&nbsp;Long&gt;&gt;(reduceShardCount)
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getSettings()
			<br>&nbsp;&nbsp;&nbsp;&nbsp;);
			<br>}
			<br>
			<br>//Configure&nbsp;Map&nbsp;Reduce&nbsp;Settings&nbsp;-&nbsp;Set&nbsp;task&nbsp;queue&nbsp;names&nbsp;for&nbsp;Map&nbsp;Reduce&nbsp;controller&nbsp;and&nbsp;workers.
			<br>private&nbsp;MapReduceSettings&nbsp;getSettings()&nbsp;{
			<br>&nbsp;&nbsp;&nbsp;&nbsp;MapReduceSettings&nbsp;settings&nbsp;=&nbsp;new&nbsp;MapReduceSettings()
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.setWorkerQueueName(&quot;mapreduce-workers&quot;)
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.setControllerQueueName(&quot;default&quot;);
			<br>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;settings;
			<br>}
		</blockquote>
		
		We need to create the task queues for map reduce controller and workers.<br/>
		Create a war/WEB-INF/queue.xml file and enter following to define and configure the task queues:
		<blockquote class="code">
			<br>&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;utf-8&quot;?&gt;
			<br>&lt;queue-entries&gt;
			<br>&nbsp;&nbsp;&lt;total-storage-limit&gt;1000M&lt;/total-storage-limit&gt;
			<br>&nbsp;&nbsp;&lt;queue&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;default&lt;/name&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;rate&gt;100/s&lt;/rate&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;bucket-size&gt;100&lt;/bucket-size&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;retry-parameters&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;task-age-limit&gt;3d&lt;/task-age-limit&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/retry-parameters&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;max-concurrent-requests&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;300
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/max-concurrent-requests&gt;
			<br>&nbsp;&nbsp;&lt;/queue&gt;
			<br>&nbsp;&nbsp;&lt;queue&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;mapreduce-workers&lt;/name&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;rate&gt;100/s&lt;/rate&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;bucket-size&gt;100&lt;/bucket-size&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;retry-parameters&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;task-age-limit&gt;3d&lt;/task-age-limit&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/retry-parameters&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;max-concurrent-requests&gt;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;100
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/max-concurrent-requests&gt;
			<br>&nbsp;&nbsp;&lt;/queue&gt;
			<br>&lt;/queue-entries&gt;
		</blockquote>
		</p>

        <h3>7. Create the Mapper</h3>
		<!-- code: mapper -->
        <blockquote class="code">
			<br>import&nbsp;com.google.appengine.tools.mapreduce.Mapper;
			<br>
			<br>class&nbsp;CountMapper&nbsp;extends&nbsp;Mapper&lt;byte[],&nbsp;String,&nbsp;Long&gt;&nbsp;{
			<br>
			<br>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;int&nbsp;category;
			<br>
			<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;CountMapper(int&nbsp;category)&nbsp;{
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.category&nbsp;=&nbsp;category;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;}
			<br>
			<br>&nbsp;&nbsp;&nbsp;&nbsp;@Override&nbsp;public&nbsp;void&nbsp;map(byte[]&nbsp;input)&nbsp;{
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;record&nbsp;=&nbsp;new&nbsp;String(input);
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String[]&nbsp;fields&nbsp;=&nbsp;record.split(&quot;,(?=([^\&quot;]*\&quot;[^\&quot;]*\&quot;)*[^\&quot;]*$)&quot;);&nbsp;&nbsp;&nbsp;&nbsp;//split&nbsp;csv&nbsp;record&nbsp;into&nbsp;fields
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;key&nbsp;=&nbsp;fields[category]&nbsp;+&nbsp;&quot;-&quot;&nbsp;+&nbsp;(fields[0].equals(&quot;0&quot;)?&quot;Died&quot;:&quot;Survived&quot;);
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getContext().emit(key,&nbsp;1);
			<br>&nbsp;&nbsp;&nbsp;&nbsp;}
			<br>
			<br>}
        </blockquote>

        <h3>8. Create the Reducer</h3>
		<!-- code: reducer -->
        <blockquote class="code">
			<br>import&nbsp;com.google.appengine.tools.mapreduce.KeyValue;
			<br>import&nbsp;com.google.appengine.tools.mapreduce.Reducer;
			<br>import&nbsp;com.google.appengine.tools.mapreduce.ReducerInput;
			<br>
			<br>class&nbsp;CountReducer&nbsp;extends&nbsp;Reducer&lt;String,&nbsp;Long,&nbsp;KeyValue&lt;String,&nbsp;Long&gt;&gt;&nbsp;{
			<br>
			<br>&nbsp;&nbsp;&nbsp;&nbsp;@Override
			<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;reduce(String&nbsp;key,&nbsp;ReducerInput&lt;Long&gt;&nbsp;values)&nbsp;{
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;total&nbsp;=&nbsp;0;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(values.hasNext())&nbsp;{
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;value&nbsp;=&nbsp;values.next();
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;total&nbsp;+=&nbsp;value;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getContext().emit(KeyValue.of(key,&nbsp;total));
			<br>&nbsp;&nbsp;&nbsp;&nbsp;}
			<br>
			<br>}
		</blockquote>

        <h3>9. Display the Map Reduce Job Status</h3>
		Create new file /war/results.jsp.<br/>
		<br/>
		...
		<!-- code: results.jsp -->
        <blockquote class="code">
			<br>&lt;%@&nbsp;page&nbsp;import=&quot;com.google.appengine.tools.pipeline.JobInfo&quot;&nbsp;%&gt;
			<br>&lt;%@&nbsp;page&nbsp;import=&quot;com.google.appengine.tools.pipeline.PipelineService&quot;&nbsp;%&gt;
			<br>&lt;%@&nbsp;page&nbsp;import=&quot;com.google.appengine.tools.pipeline.PipelineServiceFactory&quot;&nbsp;%&gt;
			<br>&lt;%@&nbsp;page&nbsp;import=&quot;com.google.appengine.tools.mapreduce.impl.ResultAndCounters&quot;&nbsp;%&gt;
			<br>&lt;%@&nbsp;page&nbsp;import=&quot;com.google.appengine.tools.mapreduce.KeyValue&quot;&nbsp;%&gt;
			<br>&lt;%@&nbsp;page&nbsp;import=&quot;com.google.common.collect.ImmutableList&quot;&nbsp;%&gt;
		</blockquote>

		...
		<blockquote class="code">
			<br>//results.jsp&nbsp;-&nbsp;body
			<br>
			<br>//display&nbsp;map&nbsp;reduce&nbsp;output
			<br>&lt;%
			<br>&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;map&nbsp;reduce&nbsp;job
			<br>&nbsp;&nbsp;&nbsp;&nbsp;PipelineService&nbsp;pipelineService&nbsp;=&nbsp;PipelineServiceFactory.newPipelineService();
			<br>&nbsp;&nbsp;&nbsp;&nbsp;JobInfo&nbsp;jobInfo&nbsp;=&nbsp;pipelineService.getJobInfo(request.getParameter(&quot;pipelineId&quot;));
			<br>
			<br>&nbsp;&nbsp;&nbsp;&nbsp;//get&nbsp;map&nbsp;reduce&nbsp;output
			<br>&nbsp;&nbsp;&nbsp;&nbsp;ResultAndCounters&nbsp;output&nbsp;=&nbsp;(ResultAndCounters)jobInfo.getOutput();
			<br>&nbsp;&nbsp;&nbsp;&nbsp;if(output==null){
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//map&nbsp;reduce&nbsp;job&nbsp;is&nbsp;not&nbsp;finished
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out.println(&quot;Output&nbsp;is&nbsp;not&nbsp;ready.&nbsp;Refresh&nbsp;the&nbsp;page&nbsp;when&nbsp;the&nbsp;map&nbsp;reduce&nbsp;job&nbsp;is&nbsp;complete.&quot;);
			<br>
			<br>&nbsp;&nbsp;&nbsp;&nbsp;}else{&nbsp;&nbsp;&nbsp;&nbsp;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//map&nbsp;reduce&nbsp;job&nbsp;is&nbsp;finished,&nbsp;display&nbsp;results&nbsp;in&nbsp;a&nbsp;table
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out.println(&quot;&lt;table&nbsp;border='1'&gt;&lt;tr&gt;&lt;th&gt;Category&lt;/th&gt;&lt;th&gt;Count&lt;/th&gt;&lt;/tr&gt;&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//key&nbsp;value&nbsp;pairs&nbsp;are&nbsp;nested&nbsp;in&nbsp;two&nbsp;lists,&nbsp;cast&nbsp;each&nbsp;level&nbsp;into&nbsp;a&nbsp;list&nbsp;and&nbsp;iterate&nbsp;through&nbsp;both
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ImmutableList&nbsp;level1&nbsp;=&nbsp;(ImmutableList)&nbsp;output.getOutputResult();
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(Object&nbsp;l2:&nbsp;level1){
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ImmutableList&lt;KeyValue&lt;String,Long&gt;&gt;&nbsp;level2&nbsp;=&nbsp;(ImmutableList&lt;KeyValue&lt;String,Long&gt;&gt;)&nbsp;l2;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for(KeyValue&lt;String,Long&gt;&nbsp;keyValuePair:&nbsp;level2){
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//print&nbsp;key&nbsp;and&nbsp;value&nbsp;as&nbsp;a&nbsp;table&nbsp;row
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out.println(&quot;&lt;tr&gt;&lt;td&gt;&quot;+keyValuePair.getKey()+&quot;&lt;/td&gt;&lt;td&gt;&quot;+keyValuePair.getValue()+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
			<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out.println(&quot;&lt;/table&gt;&quot;);
			<br>&nbsp;&nbsp;&nbsp;&nbsp;}
			<br>%&gt;
			</blockquote>

			...
			<blockquote class="code">
			<br>//display&nbsp;map&nbsp;reduce&nbsp;status
			<br>&lt;%&nbsp;
			<br>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;pipelineStatusUrl&nbsp;=&nbsp;&quot;/_ah/pipeline/status.html?root=&quot;&nbsp;+&nbsp;request.getParameter(&quot;pipelineId&quot;);&nbsp;
			<br>%&gt;
			<br>&lt;iframe&nbsp;src=&quot;&lt;%=pipelineStatusUrl%&gt;&quot;&nbsp;height=&quot;500&quot;&nbsp;width=&quot;1000&quot;&nbsp;seamless=&quot;seamless&quot;&gt;&lt;/iframe&gt;
		</blockquote>

        <h3>10. Deploy your application to Google App Engine</h3>
		<p>
		Create a Google App Engine account and create a new application. <br/>
		Update application name in your the war/WEB-INF/appengine-web.xml, and deploy!<br/> 
		Test your application by uploading one of the datasets <a href="#datasets">above</a> and running a map reduce analysis.<br/> 
		</p>
    </div>
    </body>
</html>
